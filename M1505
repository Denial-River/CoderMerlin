import Scenes                                                                                                                                                                                                                        
import Igis                                                                                                                                                                                                                          
import Foundation                                                                                                                                                                                                                    
                                                                                                                                                                                                                                     
/*                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                    \
   This class is responsible for rendering the background.                                                                                                                                                                           
 */                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                     
class Background : RenderableEntity {                                                                                                                                                                                                
    var Rectangles : [Rectangle] = [Rectangle]();                                                                                                                                                                                    
    let potato : Image                                                                                                                                                                                                               
    let carrot : Image                                                                                                                                                                                                               
    let squash: Image                                                                                                                                                                                                                
    let zucc: Image                                                                                                                                                                                                                  
                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                     
    init() {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                     
        guard let potatoURL = URL(string:"https://www.alimentarium.org/sites/default/files/media/image/2017-02/AL027-01_pomme_de_terre_0_0.jpg") else {                                                                              
            fatalError("failed to create URL for whitehouse")                                                                                                                                                                        
        }                                                                                                                                                                                                                            
        guard let carrotURL = URL(string:"https://i5.walmartimages.ca/images/Enlarge/686/686/6000198686686.jpg") else {                                                                                                              
            fatalError("failed to create URL for whitehouse")                                                                                                                                                                        
        }                                                                                                                                                                                                                            
        guard let squashURL = URL(string:"https://solidstarts.com/wp-content/uploads/Butternut-Squash-for-Babies-480x320.webp") else {                                                                                               
            fatalError("failed to create URL for whitehouse")                                                                                                                                                                        
        }                                                                                                                                                                                                                            
        guard let zuccURL = URL(string:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/CSA-Striped-Zucchini.jpg/1920px-CSA-Striped-Zucchini.jpg") else {                                                                  
            fatalError("failed to create URL for whitehouse")                                                                                                                                                                        
        }                                                                                                                                                                                                                            
        potato = Image(sourceURL:potatoURL)                                                                                                                                                                                          
        carrot = Image(sourceURL:carrotURL)                                                                                                                                                                                          
        squash = Image(sourceURL:squashURL)                                                                                                                                                                                          
        zucc = Image(sourceURL:zuccURL)                                                                                                                                                                                              
                                                                                                                                                                                                                                     
        super.init(name:"Background")                                                                                                                                                                                                
                                                                                                                                                                                                                                     
    }                                                                                                                                                                                                                                
    override func setup(canvasSize:Size, canvas:Canvas) {                                                                                                                                                                            
        func makeRect(x:Int, y:Int, width: Int, height:Int, color:Color.Name, lineWidth: Int) {                                                                                                                                      
            let rect = Rect(topLeft:Point(x:x  , y:y ), size:Size(width:width, height:height))                                                                                                                                       
            let rectangle = Rectangle(rect:rect, fillMode:.stroke)                                                                                                                                                                   
            let strokeStyle = StrokeStyle(color:Color(color))                                                                                                                                                                        
            let lineWidth = LineWidth(width:lineWidth)                                                                                                                                                                               
            canvas.render(strokeStyle, lineWidth, rectangle)                                                                                                                                                                         
        }                                                                                                                                                                                                                            
        makeRect(x:50,y:200, width: 700, height: 500, color: .green, lineWidth:5)
        makeRect(x:1100,y:50, width: 150, height: 100, color: .blue, lineWidth:5)                                                                                                                                                    
        makeRect(x:850,y:250, width: 500, height: 100, color: .red, lineWidth:5)                                                                                                                                                     
        makeRect(x:850,y:450, width: 266, height: 247, color: .orange,lineWidth:5)                                                                                                                                                   
        canvas.setup(potato, carrot, squash, zucc)                                                                                                                                                                                   
    }                                                                                                                                                                                                                                
                                                                                                                                                                                                                                     
    override func render(canvas:Canvas) {                                                                                                                                                                                            
                                                                                                                                                                                                                                     
        canvas.render(Rectangles)                                                                                                                                                                                                    
        if potato.isReady {                                                                                                                                                                                                          
            potato.renderMode = .destinationRect(Rect(topLeft:Point(x:50, y:200), size:Size(width:700, height:500)))                                                                                                                 
            canvas.render(potato)                                                                                                                                                                                                    
        }                                                                                                                                                                                                                            
        if carrot.isReady {                                                                                                                                                                                                          
            carrot.renderMode = .destinationRect(Rect(topLeft:Point(x:1100, y:50), size:Size(width:150, height:100)))                                                                                                                
            canvas.render(carrot)                                                                                                                                                                                                    
        }                                                                                                                                                                                                                            
        if squash.isReady {                                                                                                                                                                                                          
            squash.renderMode = .destinationRect(Rect(topLeft:Point(x:850, y:250), size:Size(width:500, height:100)))                                                                                                                
            canvas.render(squash)                                                                                                                                                                                                    
        }                                                                                                                                                                                                                            
        if zucc.isReady {                                                                                                                                                                                                            
            let sourceRect = Rect(topLeft:Point(x:850, y:450), size:Size(width:532, height:495))                                                                                                                                     
            let destinationRect = Rect(topLeft:Point(x:850, y:450), size:Size(width:266, height:247))                                                                                                                                
            zucc.renderMode = .sourceAndDestination(sourceRect:sourceRect, destinationRect:destinationRect)
            canvas.render(zucc)                                                                                                                                                                                                      
        }                                                                                                                                                                                                                            
    }                                                                                                                                                                                                                                
}
